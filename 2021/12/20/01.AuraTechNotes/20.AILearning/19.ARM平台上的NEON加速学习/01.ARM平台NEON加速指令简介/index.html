<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ARM平台上的NEON加速基础 | 麦溪·在路上</title><meta name="author" content="Frewen.Wang"><meta name="copyright" content="Frewen.Wang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="[TOC] 概述文章参考：https:&amp;#x2F;&amp;#x2F;arm-software.github.io&amp;#x2F;acle&amp;#x2F;neon_intrinsics&amp;#x2F; 文章参考：https:&amp;#x2F;&amp;#x2F;developer.arm.com&amp;#x2F;documentation&amp;#x2F;102467&amp;#x2F;0100&amp;#x2F; 文章参考：https:&amp;#x2F;&amp;#x2F;zhuanlan.zhih"><link rel="shortcut icon" href="/img/frewen_tech.png"><link rel="canonical" href="http://www.frewen.wang/2021/12/20/01.AuraTechNotes/20.AILearning/19.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%AD%A6%E4%B9%A0/01.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E6%8C%87%E4%BB%A4%E7%AE%80%E4%BB%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: '',
  enable_page_level_ads: 'true'
});</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ARM平台上的NEON加速基础',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-12-05 00:00:00'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/frewen_tech.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">858</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">146</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 文章标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 文章归类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文章列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/page_img.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="麦溪·在路上"><span class="site-name">麦溪·在路上</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 文章标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 文章归类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文章列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ARM平台上的NEON加速基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-12-19T16:00:00.000Z" title="发表于 2021-12-20 00:00:00">2021-12-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-12-04T16:00:00.000Z" title="更新于 2021-12-05 00:00:00">2021-12-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ARM平台上的NEON加速基础"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2021/12/20/01.AuraTechNotes/20.AILearning/19.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%AD%A6%E4%B9%A0/01.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E6%8C%87%E4%BB%A4%E7%AE%80%E4%BB%8B/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2021/12/20/01.AuraTechNotes/20.AILearning/19.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%AD%A6%E4%B9%A0/01.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E6%8C%87%E4%BB%A4%E7%AE%80%E4%BB%8B/" itemprop="commentCount"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>[TOC]</p>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>文章参考：<a target="_blank" rel="noopener" href="https://arm-software.github.io/acle/neon_intrinsics/">https://arm-software.github.io/acle/neon_intrinsics/</a></p>
<p>文章参考：<a target="_blank" rel="noopener" href="https://developer.arm.com/documentation/102467/0100/">https://developer.arm.com/documentation/102467/0100/</a></p>
<p>文章参考：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/358603760">https://zhuanlan.zhihu.com/p/358603760</a></p>
<p>文章参考：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/143328317">https://zhuanlan.zhihu.com/p/143328317</a></p>
<p>文章参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/16d60ac56249">https://www.jianshu.com/p/16d60ac56249</a></p>
<p>文章参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/chshplp_liaoping/article/details/12752749">https://blog.csdn.net/chshplp_liaoping/article/details/12752749</a></p>
<p>文章参考：<a target="_blank" rel="noopener" href="http://blog.csdn.net/chshplp_liaoping/article/details/12752749">http://blog.csdn.net/chshplp_liaoping/article/details/12752749</a></p>
<p>文章参考：<a target="_blank" rel="noopener" href="https://github.com/Denislyl/MyTechBlog2/issues/5">https://github.com/Denislyl/MyTechBlog2/issues/5</a></p>
<p>文章参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43475286/article/details/109049895">https://blog.csdn.net/weixin_43475286/article/details/109049895</a></p>
<p>文章参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Yemiekai/article/details/108009701">https://blog.csdn.net/Yemiekai/article/details/108009701</a></p>
<p>文章参考：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/397551265">https://zhuanlan.zhihu.com/p/397551265</a></p>
<p>文章参考：<a target="_blank" rel="noopener" href="http://giantpandacv.com/project/%E9%83%A8%E7%BD%B2%E4%BC%98%E5%8C%96/AI%20%E7%A7%BB%E5%8A%A8%E7%AB%AF%E7%AE%97%E6%B3%95%E4%BC%98%E5%8C%96/ARM%20Neon%20Intrinsics%20%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8C%97%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E5%88%B0%E5%AD%A6%E4%B8%AA%E9%80%9A%E9%80%8F/">http://giantpandacv.com/project/%E9%83%A8%E7%BD%B2%E4%BC%98%E5%8C%96/AI%20%E7%A7%BB%E5%8A%A8%E7%AB%AF%E7%AE%97%E6%B3%95%E4%BC%98%E5%8C%96/ARM%20Neon%20Intrinsics%20%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8C%97%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E5%88%B0%E5%AD%A6%E4%B8%AA%E9%80%9A%E9%80%8F/</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/441686632">https://zhuanlan.zhihu.com/p/441686632</a></p>
<p>Neon是ARM Cortex-A和Cortex-R系列处理器的计算加速指令集，是AI落地的工程利器。Neon Intrinsics 的出现，缓解了汇编语言难学难写的难题，值得工程师们开发利用。</p>
<p>Neon是ARM平台的向量化计算指令集，通过一条指令完成多个数据的运算达到加速的目的，常用于AI、多媒体等计算密集型任务。NEON 技术是 ARM Cortex™-A 系列处理器的 128 位 SIMD（Single instruction multiple data 单指令，多数据）架构扩展，专门针对大规模并行运算设计的，旨在为消费性多媒体应用程序提供灵活、强大的加速功能，从而显著改善用户体验。</p>
<p>NEON 技术通过加速音频和视频编解码、用户界面、2D&#x2F;3D图形和游戏来改善多媒体用户体验。NEON 还可以加速信号处理算法，以加快音频和视频处理、声音和面部识别、计算机视觉和深度学习等应用。</p>
<h1 id="ARM处理器"><a href="#ARM处理器" class="headerlink" title="ARM处理器"></a><strong>ARM处理器</strong></h1><p>针对每一种ARM架构，ARM都设计了很多的处理器（内核），这里就不列出来了，感兴趣去官网能够查找。这里主要讲讲命名的变化。</p>
<p>主要分为：<strong>经典处理器、Cortex-M系列处理器、Cortex-R系列处理器、Cortex-A系列处理器</strong></p>
<p>经典处理器都是按照数字命名的，直到ARM11。也就是推出架构v7的时候，ARM公司把产品并分为三大产品线，分别是Cortex-A、Cortex-R和Cortex-M。</p>
<p>近两年推出的cortex-X并不是单独的产品线，它可看做cortex-A的升级版，两者的市场定位是一样的。</p>
<p><strong>Cortex-A系列处理器是针对高端应用</strong>而设计的，通常应用于智能手机、平板电脑、数字电视和网络设备等。这些处理器拥有高性能、大规模的内存管理单元以及大量的内部缓存，支持多核处理和虚拟化技术。</p>
<p><strong>Cortex-R系列处理器是针对实时应用</strong>而设计的，通常应用于汽车、工业控制和医疗设备等。这些处理器拥有极低的延迟、高精度的计时器和内部存储器保护机制，能够在实时响应和高可靠性方面表现出色。</p>
<p><strong>Cortex-M系列处理器是针对低功耗、低成本、嵌入式应用</strong>而设计的，通常应用于传感器、智能家居、工业控制和医疗设备等。这些处理器拥有低功耗、小尺寸和低成本等优点，同时也支持实时性、安全性和可靠性等特性。</p>
<p>ARM CPU 最初只有普通的寄存器，可以进行基本数据类型的基础运算。从 ARMv5 架构开始引入 VFP（vector-floating-point） 指令扩展，可以通过使用短向量指令来加速浮点计算。从 ARMv7 架构开始引入 NEON 技术，NEON 技术同样是依靠向量指令来加速计算。鉴于 NEON 技术提供的向量技术加速效果体验更优秀，从 ARMv7 架构开始使用 VFP 向量指令加速的模式被弃用，因此 VFP 单元有时也称之为 FPU（Floating Point Unit）单元。</p>
<h1 id="SIMD概念"><a href="#SIMD概念" class="headerlink" title="SIMD概念"></a><strong>SIMD概念</strong></h1><p>ARM NEON 技术本质上是一种高级的单指令多数据（SIMD）架构扩展，这种扩展仅在一些 ARMv7-A 和 ARMv7-R 架构以及 ARMv8 架构上支持。和 SSE&#x2F;AVX 类似: 一条指令以指令级SIMD的方式同时对多个数据进行操作，同时，操作的数据个数由向量寄存器的长度和数据类型共同决定。</p>
<p>对于SISD，每个指令只能处理一个数据，而SIMD一个指令可以处理多个数据，因为多个数据的处理是平行的，因此从时间来说，一个指令执行的时间，SISD和SIMD是差不多的。由于SIMD一次可以处理N个数据，所以它的处理的时间也就缩短到SISD的1&#x2F;N。</p>
<p><img src="/images/jidunqi.gif" alt="jidunqi"></p>
<p>需要指出一点，NEON是需要硬件的支持的，需要有一块寄存器放到硬件上来处理这个的。</p>
<p><strong>SIMD</strong> 特别适用于一些常见的任务，如音频图像处理。大部分现代 CPU 设计都包含了 SIMD 指令，来提高多媒体使用的性能。</p>
<p><img src="/images/v2-c6cd0aec985be6e0e6bfdea6259ede87_1440w.png" alt="img"></p>
<p>如上图所示，标量运算时一次只能对一对数据执行乘法操作，而采用 SIMD 乘法指令，则一次可以对四对数据同时执行乘法操作。</p>
<h1 id="NEON向量寄存器"><a href="#NEON向量寄存器" class="headerlink" title="NEON向量寄存器"></a>NEON向量寄存器</h1><p>NEON 寄存器主要是用来存放包含相同数据类型元素的向量。</p>
<p>在 ARMv7 架构中， 一共有16个128位寄存器，这个128位寄存器也称之为 Q 寄存器，一个128位寄存器又可以分为两个64位寄存器，即一共有32个64位寄存器，64位寄存器又称之为 D 寄存器。</p>
<p>在ARMv8 架构中寄存器的数量相比 ARMv7 架构数量翻倍。Q 寄存器和 D 寄存器对应表如下所示：</p>
<img src="./images/01.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E6%8C%87%E4%BB%A4%E7%AE%80%E4%BB%8B/image-20230702114342852.png" alt="image-20230702114342852" style="zoom: 50%;" />





<p><img src="/./images/01.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/v2-5f7ce93be485d0725504e70b430a7c6e_r.jpg" alt="img"></p>
<p>NEON SIMD 寄存器的长度为 128 位，如果操作 32 位浮点数，可同时操作 4 个；如果操作 16 位整数（short），可同时操作 8 个；而如果操作 8 位整数，则可同时操作 16 个。</p>
<h2 id="AArchh32-x2F-ARMV7向量寄存器"><a href="#AArchh32-x2F-ARMV7向量寄存器" class="headerlink" title="AArchh32 &#x2F; ARMV7向量寄存器"></a>AArchh32 &#x2F; ARMV7向量寄存器</h2><p>AArch32&#x2F;Armv7 有 16 个 128bit 的向量寄存器，这些寄存器又可以划分为：</p>
<ul>
<li>16 个128bit 的 Q 寄存器，Q0~Q15。</li>
<li>32 个 64bit 的 D 寄存器，D0~D31。</li>
<li>64 个 32bit 的 S 寄存器，S0~S63。  TODO</li>
</ul>
<p>每种类型寄存器的映射关系如下：</p>
<p>​																					AArch32 SIMD register</p>
<p><img src="/./images/01.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/v2-5c673b301e7e989719417a3936f514c8_r.jpg" alt="img"></p>
<p>ARMv7 NEON 指令集架构具有 16 个 128 位的向量寄存器，命名为 q0～q15。这 16 个寄存器又可以拆分成 32 个 64 位寄存器，命名为 d0～d31。其中qn和d2n，d2n+1是一样的，故使用汇编编写代码时要注意避免产生寄存器覆盖。</p>
<p>有16个128位四字到寄存器Q0-Q15，32个64位双子寄存器D0-D31，两个寄存器是重叠的，在使用到时候需要特别注意，不小心就会覆盖掉。如下图所示：</p>
<p>两个寄存器的关系：Qn &#x3D;D2n和D2n+1，如Q8是d16和d17的组合。</p>
<p><img src="/images/01.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F/20131015173126937.jpeg" alt="img"></p>
<h2 id="AArch64-向量寄存器"><a href="#AArch64-向量寄存器" class="headerlink" title="AArch64 向量寄存器"></a>AArch64 向量寄存器</h2><p>AArch64 有 32 个 128bit 的向量寄存器，这些寄存器又可以划分为：</p>
<p>TODO   错误！！！！</p>
<ul>
<li>32 个 128bit 的 V 寄存器，V0~V31。</li>
<li>32 个 64bit 的 D 寄存器，D0~D31。</li>
<li>32 个 32bit 的 S 寄存器，S0~S31。</li>
</ul>
<p>每种类型寄存器的映射关系如下：</p>
<p>​																					AArch64 SIMD register</p>
<p><img src="/./images/01.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/v2-e125db188a5ec99c8f9645fd05f2fe45_1440w.png" alt="img"></p>
<h1 id="NEON-intrinsics（NEON内联）-和-NEON-assembly（NEON汇编）"><a href="#NEON-intrinsics（NEON内联）-和-NEON-assembly（NEON汇编）" class="headerlink" title="NEON  intrinsics（NEON内联） 和 NEON assembly（NEON汇编）"></a>NEON  intrinsics（NEON内联） 和 NEON assembly（NEON汇编）</h1><p>intrinsics 是以类似调用 C 语言函数的方法调用 Neon，并由编译器生成最终的二进制代码，assembly 则是手工嵌入 Neon 汇编，直接生成二进制代码。</p>
<p>Intrinsic_C用起来简单，还能跨armv7，armv8，每一个API接口都对应着相应的一条指令。由于充满了sign&#x2F;unsign，int、short、char，8x8,16x8 ，加 减 乘，长宽，收窄，饱和，位移等等，在arm_neon.h里有几百个Api，但是殊途同归，大同小异，每了解1个汇编指令，就能通吃10~20个Api。<br>        这里有份帮助文档：<a target="_blank" rel="noopener" href="https://blog.csdn.net/fengbingchun/article/details/38085781">https://blog.csdn.net/fengbingchun/article/details/38085781</a><br>        汇编代码就不能跨armv7，armv8了，但是真正懂得每个汇编指令的意思，才能优化到极致。懂了汇编，反过来写Intrinsic_C也大有帮助。</p>
<p>TODO 后续我们可以学习一下这两个的区别。</p>
<p>我们现在主要学习的是NEON  intrinsics</p>
<p>如果您想了解的是 Neon assembly，可以参考这篇文章：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/143328317">https://zhuanlan.zhihu.com/p/143328317</a></p>
<h1 id="NEON加速应用场景"><a href="#NEON加速应用场景" class="headerlink" title="NEON加速应用场景"></a>NEON加速应用场景</h1><h2 id="Android启用NEON"><a href="#Android启用NEON" class="headerlink" title="Android启用NEON"></a>Android启用NEON</h2><p>直接参考 ARM 官方的 Demo 制作教程（还带了演示编写代码的视频）：</p>
<p><strong>Neon Intrinsics Getting Started on Android</strong>（<a target="_blank" rel="noopener" href="https://developer.arm.com/solutions/os/android/developer-guides/neon-intrinsics-getting-started-on-android%EF%BC%89">https://developer.arm.com/solutions/os/android/developer-guides/neon-intrinsics-getting-started-on-android）</a></p>
<p><strong>Neon Intrinsics on Android How to Truncate Thresholding and Convolution of A 1D Signal</strong> （<a target="_blank" rel="noopener" href="https://developer.arm.com/solutions/os/android/developer-guides/neon-intrinsics-on-android-how-to-truncate-thresholding-and-convolution-of-a-1d-signal%EF%BC%89">https://developer.arm.com/solutions/os/android/developer-guides/neon-intrinsics-on-android-how-to-truncate-thresholding-and-convolution-of-a-1d-signal）</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/ndk/guides/cpu-arm-neon.html">https://developer.android.com/ndk/guides/cpu-arm-neon.html</a></p>
<p>核心点就是，在 Gradle 加上 Neon 的启用命令（如下红框），然后在 cpp 引用头文件 <strong>#include</strong> ，写代码就完事了。余下的都是带 Native 代码的安卓开发的知识。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">externalNativeBuild &#123; </span><br><span class="line">       cmake &#123; </span><br><span class="line">           cppFlags <span class="string">&quot;-std=c++14&quot;</span> </span><br><span class="line">           arguments <span class="string">&quot;-DANDROID_ARM_NEON=TRUE&quot;</span> </span><br><span class="line">       &#125; </span><br><span class="line">   &#125; </span><br></pre></td></tr></table></figure>

<p>还要在cmake中添加对neon的支持 “-mfpu&#x3D;neon”</p>
<p>最后在cpp中 #include<code>&lt;arm_neon.h&gt;</code></p>
<p>这样，项目就可以支持neon加速了。</p>
<h2 id="iOS启用NEON"><a href="#iOS启用NEON" class="headerlink" title="iOS启用NEON"></a>iOS启用NEON</h2><p><strong>关于在 iOS 开发中启用 Neon（Xcode，尝试的版本为 12.3</strong>）：笔者尝试过将 Android 的 NDK 代码迁移至 iOS，在不修改 Xcode 任何设置的情况下，arm_neon.h 可找到，编译可通过，那说明 Xcode 默认打开了 Neon 的启用开关，写就完事了。</p>
<h2 id="NCNN推理加速库"><a href="#NCNN推理加速库" class="headerlink" title="NCNN推理加速库"></a>NCNN推理加速库</h2><p>（<a target="_blank" rel="noopener" href="https://github.com/Tencent/ncnn/tree/e16b338b136c94805bc7d0ef3756f2dc4bfa3408/src/layer%EF%BC%89%E6%98%AF%E8%85%BE%E8%AE%AF%E5%BC%80%E6%BA%90%EF%BC%8Cnihui">https://github.com/Tencent/ncnn/tree/e16b338b136c94805bc7d0ef3756f2dc4bfa3408/src/layer）是腾讯开源，nihui</a> 维护的 AI 推理引擎。2017 开源至今，其代码依然保持着组织结构简单、易重用的优点。ncnn 实现的算子包含普通实现（无针平台的加速）和针对 3 种平台（arm&#x2F;vulkan&#x2F;x86）的指令集加速实现（注：可能有的算子有普通实现，但没有平台加速实现，毕竟做加速实现还是比较耗费精力的）。</p>
<p>由于 Neon 实现往往跟循环展开等技巧一起使用，代码往往比较长。我们可以先阅读普通实现的代码实现了解顶层逻辑，再阅读 Neon 实现的代码。例如，我们希望学习全连接层（innerproduct）的 Neon 实现，其普通实现的位置在 ncnn&#x2F;src&#x2F;layer&#x2F;innerproduct.cpp，对应的 Neon 加速实现的位置在 ncnn&#x2F;src&#x2F;layer&#x2F;arm&#x2F;innerproduct_arm.cpp。</p>
<p><img src="/./images/01.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/c51b9ccf1c84672a9b631adda1fe0ad4.png" alt="ncnn的算子代码组织逻辑"></p>
<p>注意代码中出现较多的条件编译。原因我们上文提到过，有的 intrinsics 是较新 Aarch64 架构下专有的，为了兼容较老的 ArmV7a 架构，对于不能用的 intrinsics 只能用多条兼容的 intrinsics 等效替代。为了保证 Aarch64 下的性能同时保证对 ArmV7a 的兼容性，ncnn 采用条件编译的方式处理不兼容的 intrinsics（条件编译就是编译满足条件的分枝的代码，不满足条件的代码将不出现在最终的二进制文件中）。</p>
<p>如果你只关注 Aarch64 平台下的实现，下图 #else 分支的代码跳过不看即可。</p>
<p><img src="/./images/01.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/fe9581548112de6a70bb1649520f5a64.png" alt="innerproduct_arm代码（部分）"></p>
<h2 id="Nvidia-carotene-库"><a href="#Nvidia-carotene-库" class="headerlink" title="Nvidia carotene 库"></a>Nvidia carotene 库</h2><p>了解 <strong>carotene</strong>（<a target="_blank" rel="noopener" href="https://github.com/opencv/opencv/tree/master/3rdparty/carotene%EF%BC%89%E5%BA%93%E7%9A%84%E4%BA%BA%E5%BA%94%E8%AF%A5%E4%B8%8D%E5%A4%9A%EF%BC%8C%E4%BD%86%E4%BA%86%E8%A7%A3">https://github.com/opencv/opencv/tree/master/3rdparty/carotene）库的人应该不多，但了解</a> OpenCV 的人应该不少吧？carotene 能够作为 OpenCV 的第三方库（third party）存在，足以证明其代码质量。</p>
<p>carotene 的组织结构同样简单，且不依赖 OpenCV 的数据结构，想用想学习哪个函数直接提取出来即可。如下图，里面主要用 Neon 实现了色彩空间转换、均值滤波、Canny 边缘检测等常见的图像处理算子。</p>
<p><img src="/./images/01.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/ac736df3b03b20c416b4de4b6cb47b50-20230701153603399.png" alt="carotene库"></p>
<h1 id="示例Demo"><a href="#示例Demo" class="headerlink" title="示例Demo"></a>示例Demo</h1><p>这里以一个小例子来解释如何利用NEON内置函数来加速实现统计一个数组内的元素之和。</p>
<p>以C++代码为例：</p>
<p>原始算法代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">sum_array</span><span class="params">(<span class="type">float</span> *arr, <span class="type">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">NULL</span> == arr || len &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;input error\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">float</span> <span class="title">sum</span><span class="params">(<span class="number">0.0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;len; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        sum += *arr++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对于长度为N的数组，上述算法的时间复杂度时O(N)。<br>        采用NEON函数进行加速：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arm_neon.h&gt;</span> <span class="comment">//需包含的头文件</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">sum_array</span><span class="params">(<span class="type">float</span> *arr, <span class="type">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">NULL</span> == arr || len &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;input error\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> 	<span class="comment">// 进行数组除以4取值</span></span><br><span class="line">    <span class="type">int</span> dim4 = len &gt;&gt; <span class="number">2</span>; <span class="comment">// 数组长度除4整数</span></span><br><span class="line">    <span class="type">int</span> left4 = len &amp; <span class="number">3</span>; <span class="comment">// 数组长度除4余数</span></span><br><span class="line">    <span class="type">float32x4_t</span> sum_vec = <span class="built_in">vdupq_n_f32</span>(<span class="number">0.0</span>); <span class="comment">//定义用于暂存累加结果的寄存器且初始化为0</span></span><br><span class="line">    <span class="keyword">for</span> (; dim4&gt;<span class="number">0</span>; dim4--, arr+=<span class="number">4</span>) <span class="comment">//每次同时访问4个数组元素</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">float32x4_t</span> data_vec = <span class="built_in">vld1q_f32</span>(arr); <span class="comment">//依次取4个元素存入寄存器vec</span></span><br><span class="line">        sum_vec = <span class="built_in">vaddq_f32</span>(sum_vec, data_vec);<span class="comment">//ri = ai + bi 计算两组寄存器对应元素之和并存放到相应结果</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">////将累加结果寄存器中的所有元素相加得到最终累加值</span></span><br><span class="line">    <span class="type">float</span> sum = <span class="built_in">vgetq_lane_f32</span>(sum_vec, <span class="number">0</span>)+<span class="built_in">vgetq_lane_f32</span>(sum_vec, <span class="number">1</span>)+<span class="built_in">vgetq_lane_f32</span>(sum_vec, <span class="number">2</span>)+<span class="built_in">vgetq_lane_f32</span>(sum_vec, <span class="number">3</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将剩下的少于4的数字，依次计算累加即可</span></span><br><span class="line">    <span class="keyword">for</span> (; left4&gt;<span class="number">0</span>; left4--, arr++)</span><br><span class="line">        sum += (*arr) ;   <span class="comment">//对于剩下的少于4的数字，依次计算累加即可</span></span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面我们来讲解一下上面的代码：</p>
<p>上述算法的时间复杂度时O(N&#x2F;4)</p>
<p>从上面的例子看出，使用NEON函数很简单，只需要将依次处理，变为批处理（如上面的每次处理4个）。</p>
<p>上面用到的函数有：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将value复制4份存到返回的寄存器中</span></span><br><span class="line"><span class="function"><span class="type">float32x4_t</span> <span class="title">vdupq_n_f32</span> <span class="params">(<span class="type">float32_t</span> value)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 从数组中依次Load4个元素存到寄存器中(就是将数组的四个元素当道寄存器中)</span></span></span><br><span class="line"><span class="function"><span class="type">float32x4_t</span> <span class="title">vld1q_f32</span> <span class="params">(<span class="type">float32_t</span> <span class="type">const</span> * ptr)</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="comment">// 相应的 有将寄存器中的值写入数组中    </span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">vst1q_f32</span> <span class="params">(<span class="type">float32_t</span> * ptr, <span class="type">float32x4_t</span> val)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 返回两个寄存器对应元素之和(add) r = a+b</span></span></span><br><span class="line"><span class="function"><span class="type">float32x4_t</span> <span class="title">vaddq_f32</span> <span class="params">(<span class="type">float32x4_t</span> a, <span class="type">float32x4_t</span> b)</span>    </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 返回两个寄存器对应元素之差（sub） r = a-b    </span></span></span><br><span class="line"><span class="function"><span class="type">float32x4_t</span> <span class="title">vsubq_f32</span> <span class="params">(<span class="type">float32x4_t</span> a, <span class="type">float32x4_t</span> b)</span>  </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 返回寄存器某一lane的值    </span></span></span><br><span class="line"><span class="function"><span class="type">float32_t</span> <span class="title">vgetq_lane_f32</span> <span class="params">(<span class="type">float32x4_t</span> v, <span class="type">const</span> <span class="type">int</span> lane)</span>    </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 其他常用的函数还有：    </span></span></span><br><span class="line"><span class="function"><span class="type">float32x4_t</span> <span class="title">vmulq_f32</span> <span class="params">(<span class="type">float32x4_t</span> a, <span class="type">float32x4_t</span> b)</span>   <span class="comment">// 返回两个寄存器对应元素之积 r = a*b</span></span></span><br><span class="line"><span class="function"><span class="type">float32x4_t</span> <span class="title">vmlaq_f32</span> <span class="params">(<span class="type">float32x4_t</span> a, <span class="type">float32x4_t</span> b, <span class="type">float32x4_t</span> c)</span>  <span class="comment">// r = a +b*c</span></span></span><br><span class="line"><span class="function"><span class="type">float32x4_t</span> <span class="title">vextq_f32</span> <span class="params">(<span class="type">float32x4_t</span> a, <span class="type">float32x4_t</span> b, <span class="type">const</span> <span class="type">int</span> n)</span>   <span class="comment">// 拼接两个寄存器并返回从第n位开始的大小为4的寄存器 0&lt;=n&lt;=3</span></span></span><br><span class="line"><span class="function"><span class="comment">// 例如</span></span></span><br><span class="line"><span class="function">a: <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></span></span><br><span class="line"><span class="function">b: <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span></span></span><br><span class="line"><span class="function">vextq_f32(a,b,<span class="number">1</span>) -&gt; r: <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></span></span><br><span class="line"><span class="function">vextq_f32(a,b,<span class="number">2</span>) -&gt; r: <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span></span></span><br><span class="line"><span class="function">vextq_f32(a,b,<span class="number">3</span>) -&gt; r: <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span>    </span></span><br></pre></td></tr></table></figure>

<p>参考下面的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">float32x4_t sum = vdupq_n_f32(0);</span><br><span class="line">float _a[] = &#123;1,2,3,4&#125;, _b[] = &#123;5,6,7,8&#125; ;</span><br><span class="line">float32x4_t a = vld1q_f32(_a), b = vld1q_f32(_b)  ;</span><br><span class="line">float32x4_t sum1 = vfmaq_laneq_f32(sum, a, b, 0);</span><br><span class="line">float32x4_t sum2 = vfmaq_laneq_f32(sum1, a, b, 1);</span><br><span class="line">float32x4_t sum3 = vfmaq_laneq_f32(sum2, a, b, 2);</span><br></pre></td></tr></table></figure>

<p>neon各种指令的官方检索和解释可以参考：</p>
<p><a target="_blank" rel="noopener" href="https://developer.arm.com/technologies/neon/intrinsics">https://developer.arm.com/technologies/neon/intrinsics</a></p>
<p>自己理解并注释的一段代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">float32x4_t _r00 = vld1q_f32(r0);//将r0开头的4个连续地址存放的数据load到neon寄存器</span><br><span class="line">float32x4_t _r10 = vld1q_f32(r1);</span><br><span class="line">float32x4_t _r20 = vld1q_f32(r2);</span><br><span class="line">float32x4_t _r30 = vld1q_f32(r3);</span><br><span class="line"> </span><br><span class="line">float32x4_t _sum = vmulq_f32(_r00, _k0123);//两个参数的点乘</span><br><span class="line">_sum = vmlaq_f32(_sum, _r10, _k3456);//_sum + _r10 .* _k3456, 点对点操作</span><br><span class="line">_sum = vmlaq_f32(_sum, _r20, _k6789);</span><br><span class="line"> </span><br><span class="line">float32x4_t _sum2 = vmulq_f32(_r10, _k0123);</span><br><span class="line">_sum2 = vmlaq_f32(_sum2, _r20, _k3456);</span><br><span class="line">_sum2 = vmlaq_f32(_sum2, _r30, _k6789);</span><br><span class="line"> </span><br><span class="line">_sum = vsetq_lane_f32(*outptr, _sum, 3);//*outptr赋值给将_sum中index为3的元素（即最后一个），为累加做准备</span><br><span class="line">_sum2 = vsetq_lane_f32(*outptr2, _sum2, 3);</span><br><span class="line"> </span><br><span class="line">float32x2_t _ss = vadd_f32(vget_low_f32(_sum), vget_high_f32(_sum));//将128位寄存器中高64的两个参数与低68位的两个参数对应相加</span><br><span class="line">float32x2_t _ss2 = vadd_f32(vget_low_f32(_sum2), vget_high_f32(_sum2));</span><br><span class="line"> </span><br><span class="line">float32x2_t _sss2 = vpadd_f32(_ss, _ss2);//adds adjacent pairs of elements of two vectors</span><br><span class="line"> </span><br><span class="line">*outptr = vget_lane_f32(_sss2, 0);//get 0th parameter in vector</span><br><span class="line">                    *outptr2 = vget_lane_f32(_sss2, 1);</span><br></pre></td></tr></table></figure>



<p>为了比较性能，现在用neon和纯C方法比较一下将彩色图片转成灰度的时间</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//纯C函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">method_argb2gray_c</span><span class="params">(AndroidBitmapInfo info, <span class="type">void</span> *pixels)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// rgb转灰度值公式</span></span><br><span class="line">    <span class="comment">// Gray = (R*38 + G*75 + B*15) &gt;&gt; 7</span></span><br><span class="line">    cv::TickMeter tm1;</span><br><span class="line">    tm1.<span class="built_in">start</span>();</span><br><span class="line">    <span class="type">uint32_t</span> *pixel = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">0</span>, r = <span class="number">0</span>, g = <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> rows=info.height;</span><br><span class="line">    <span class="type">int</span> cols=info.width;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; y &lt; rows; ++y) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; cols; ++x) &#123;</span><br><span class="line">            pixel = (<span class="type">uint32_t</span> *) pixels + info.width * y + x;</span><br><span class="line">            a = (*pixel &amp; <span class="number">0xFF000000</span>) &gt;&gt; <span class="number">24</span>;</span><br><span class="line">            r = (*pixel &amp; <span class="number">0x00FF0000</span>) &gt;&gt; <span class="number">16</span>;</span><br><span class="line">            g = (*pixel &amp; <span class="number">0x0000FF00</span>) &gt;&gt; <span class="number">8</span>;</span><br><span class="line">            b = (*pixel &amp; <span class="number">0x000000FF</span>) &gt;&gt; <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> gray = (r * <span class="number">38</span> + g * <span class="number">75</span> + b * <span class="number">15</span>) &gt;&gt; <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">            *pixel = ((a &lt;&lt; <span class="number">24</span>) | (gray &lt;&lt; <span class="number">16</span>) | (gray &lt;&lt; <span class="number">8</span>) | gray);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    tm1.<span class="built_in">stop</span>();</span><br><span class="line">    <span class="built_in">LOGI</span>(<span class="string">&quot;method_argb2gray_c      time: %lf&quot;</span>, tm1.<span class="built_in">getTimeMilli</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//neon函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">method_argb2gray_neon</span><span class="params">(AndroidBitmapInfo info, <span class="type">void</span> *pixels)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Gray = (R*38 + G*75 + B*15) &gt;&gt; 7</span></span><br><span class="line">    TickMeter tm3;</span><br><span class="line">    tm3.<span class="built_in">start</span>();</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> *dst = (<span class="type">unsigned</span> <span class="type">short</span> *) pixels;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> *src = (<span class="type">unsigned</span> <span class="type">char</span> *) pixels;</span><br><span class="line">    <span class="type">uint8x8_t</span> r = <span class="built_in">vdup_n_u8</span>(<span class="number">38</span>);</span><br><span class="line">    <span class="type">uint8x8_t</span> g = <span class="built_in">vdup_n_u8</span>(<span class="number">75</span>);</span><br><span class="line">    <span class="type">uint8x8_t</span> b = <span class="built_in">vdup_n_u8</span>(<span class="number">15</span>);</span><br><span class="line">    <span class="type">uint16x8_t</span> alp = <span class="built_in">vdupq_n_u16</span>(<span class="number">255</span> &lt;&lt; <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">uint16x8_t</span> temp;</span><br><span class="line">    <span class="type">uint8x8_t</span> gray;</span><br><span class="line">    <span class="type">uint8x8x4_t</span> argb;</span><br><span class="line">    <span class="type">uint16x8_t</span> hight;</span><br><span class="line">    <span class="type">uint16x8_t</span> low;</span><br><span class="line">    <span class="type">uint16x8x2_t</span> res;</span><br><span class="line">    <span class="type">int</span> i, size = info.height * info.width / <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; size; ++i) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取r、g、b值，计算灰度值</span></span><br><span class="line">        argb = <span class="built_in">vld4_u8</span>(src);</span><br><span class="line">        temp = <span class="built_in">vmull_u8</span>(argb.val[<span class="number">1</span>], r);</span><br><span class="line">        temp = <span class="built_in">vmlal_u8</span>(temp, argb.val[<span class="number">2</span>], g);</span><br><span class="line">        temp = <span class="built_in">vmlal_u8</span>(temp, argb.val[<span class="number">3</span>], b);</span><br><span class="line">        gray = <span class="built_in">vshrn_n_u16</span> (temp, <span class="number">7</span>);</span><br><span class="line">        src += <span class="number">8</span> * <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//赋值4通道argb</span></span><br><span class="line">        hight = <span class="built_in">vorrq_u16</span>(alp, <span class="built_in">vmovl_u8</span>(gray));</span><br><span class="line">        low = <span class="built_in">vorrq_u16</span>(<span class="built_in">vshlq_n_u16</span>(<span class="built_in">vmovl_u8</span>(gray), <span class="number">8</span>), <span class="built_in">vmovl_u8</span>(gray));</span><br><span class="line">        res = <span class="built_in">vzipq_u16</span>(low, hight);</span><br><span class="line">        <span class="built_in">vst1q_u16</span>(dst, res.val[<span class="number">0</span>]);</span><br><span class="line">        dst += <span class="number">8</span>;</span><br><span class="line">        <span class="built_in">vst1q_u16</span>(dst, res.val[<span class="number">1</span>]);</span><br><span class="line">        dst += <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    tm3.<span class="built_in">stop</span>();</span><br><span class="line">    <span class="built_in">LOGI</span>(<span class="string">&quot;method_argb2gray_neon   time: %lf&quot;</span>, tm3.<span class="built_in">getTimeMilli</span>());</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>















</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://www.frewen.wang">Frewen.Wang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://www.frewen.wang/2021/12/20/01.AuraTechNotes/20.AILearning/19.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%AD%A6%E4%B9%A0/01.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E6%8C%87%E4%BB%A4%E7%AE%80%E4%BB%8B/">http://www.frewen.wang/2021/12/20/01.AuraTechNotes/20.AILearning/19.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%AD%A6%E4%B9%A0/01.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E6%8C%87%E4%BB%A4%E7%AE%80%E4%BB%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.frewen.wang" target="_blank">麦溪·在路上</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/">神经网络</a><a class="post-meta__tags" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a><a class="post-meta__tags" href="/tags/NEON/">NEON</a></div><div class="post_share"><div class="social-share" data-image="/img/frewen_tech.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat_square.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat_square.jpg" alt="微信打赏"/></a><div class="post-qr-code-desc">微信打赏</div></li><li class="reward-item"><a href="/img/alipay_square.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay_square.jpg" alt="支付宝打赏"/></a><div class="post-qr-code-desc">支付宝打赏</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/01/05/01.AuraTechNotes/15.CLang/03.C++%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/20.C++%E7%BC%96%E8%AF%91%E7%9B%B8%E5%85%B3/01.CMake%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/20.cmake%E7%9A%84add_custom_command%E5%92%8Cadd_custom_target%E6%8C%87%E4%BB%A4/" title="Android之性能监控框架"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Android之性能监控框架</div></div></a></div><div class="next-post pull-right"><a href="/2021/12/20/01.AuraTechNotes/20.AILearning/19.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%AD%A6%E4%B9%A0/02.NEON%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E6%8C%87%E4%BB%A4%E4%BB%8B%E7%BB%8D/" title="ARM平台上的NEON加速基础"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ARM平台上的NEON加速基础</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/12/20/01.AuraTechNotes/20.AILearning/19.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%AD%A6%E4%B9%A0/02.NEON%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E6%8C%87%E4%BB%A4%E4%BB%8B%E7%BB%8D/" title="ARM平台上的NEON加速基础"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-20</div><div class="title">ARM平台上的NEON加速基础</div></div></a></div><div><a href="/2021/12/20/01.AuraTechNotes/20.AILearning/19.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%AD%A6%E4%B9%A0/05.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84%E5%9B%BE%E5%83%8F%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0/" title="ARM平台上的图像格式转换的NEON加速函数实现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-20</div><div class="title">ARM平台上的图像格式转换的NEON加速函数实现</div></div></a></div><div><a href="/2021/12/20/01.AuraTechNotes/20.AILearning/19.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%AD%A6%E4%B9%A0/04.ARM%E5%B9%B3%E5%8F%B0NEON%20instrinsics%E6%8C%87%E4%BB%A4%E5%AD%A6%E4%B9%A0/" title="ARM平台NEON instrinsics指令学习"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-20</div><div class="title">ARM平台NEON instrinsics指令学习</div></div></a></div><div><a href="/2021/12/20/01.AuraTechNotes/20.AILearning/19.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%AD%A6%E4%B9%A0/06.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E4%BD%BF%E7%94%A8NEON%E5%8A%A0%E9%80%9F%E5%AE%8C%E6%88%903X3%20max%20pool%E5%AE%9E%E7%8E%B0/" title="ARM平台上使用NEON加速完成3X3 max pool实现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-20</div><div class="title">ARM平台上使用NEON加速完成3X3 max pool实现</div></div></a></div><div><a href="/2021/12/20/01.AuraTechNotes/20.AILearning/19.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%AD%A6%E4%B9%A0/07.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E5%B8%B8%E7%94%A8%E7%9A%84%E5%87%BD%E6%95%B0/" title="ARM平台上NEON加速常用的函数"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-20</div><div class="title">ARM平台上NEON加速常用的函数</div></div></a></div><div><a href="/2021/12/20/01.AuraTechNotes/20.AILearning/19.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%AD%A6%E4%B9%A0/09.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8AYUV420SP%E8%BD%ACRGB%E5%AE%9E%E8%B7%B5%E4%BC%98%E5%8C%96/" title="ARM平台上YUV420SP转RGB实践优化"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-20</div><div class="title">ARM平台上YUV420SP转RGB实践优化</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div class="comment-switch"><span class="first-comment">Valine</span><span id="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/frewen_tech.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Frewen.Wang</div><div class="author-info__description">在青麦地上跑着,雪和太阳的光芒</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">858</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">146</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/FrewenWang"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/FrewenWang" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:frewen1225@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://plus.google.com/FrewenWong" target="_blank" title="Google"><i class="fa-brands fa-google"></i></a><a class="social-icon" href="https://twitter.com/FrewenWong" target="_blank" title="Twitter"><i class="fa-brands fa-twitter"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ARM%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">2.</span> <span class="toc-text">ARM处理器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SIMD%E6%A6%82%E5%BF%B5"><span class="toc-number">3.</span> <span class="toc-text">SIMD概念</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NEON%E5%90%91%E9%87%8F%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">4.</span> <span class="toc-text">NEON向量寄存器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#AArchh32-x2F-ARMV7%E5%90%91%E9%87%8F%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">4.1.</span> <span class="toc-text">AArchh32 &#x2F; ARMV7向量寄存器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AArch64-%E5%90%91%E9%87%8F%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">4.2.</span> <span class="toc-text">AArch64 向量寄存器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NEON-intrinsics%EF%BC%88NEON%E5%86%85%E8%81%94%EF%BC%89-%E5%92%8C-NEON-assembly%EF%BC%88NEON%E6%B1%87%E7%BC%96%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">NEON  intrinsics（NEON内联） 和 NEON assembly（NEON汇编）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NEON%E5%8A%A0%E9%80%9F%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">6.</span> <span class="toc-text">NEON加速应用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Android%E5%90%AF%E7%94%A8NEON"><span class="toc-number">6.1.</span> <span class="toc-text">Android启用NEON</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iOS%E5%90%AF%E7%94%A8NEON"><span class="toc-number">6.2.</span> <span class="toc-text">iOS启用NEON</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NCNN%E6%8E%A8%E7%90%86%E5%8A%A0%E9%80%9F%E5%BA%93"><span class="toc-number">6.3.</span> <span class="toc-text">NCNN推理加速库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nvidia-carotene-%E5%BA%93"><span class="toc-number">6.4.</span> <span class="toc-text">Nvidia carotene 库</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8BDemo"><span class="toc-number">7.</span> <span class="toc-text">示例Demo</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/28/01.AuraTechNotes/09.Python/12.python%E7%9A%84pycharm%E7%9A%84%E4%BD%BF%E7%94%A8/01.pycharm%E7%9A%84%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" title="无题">无题</a><time datetime="2023-07-28T11:06:28.000Z" title="发表于 2023-07-28 19:06:28">2023-07-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/27/01.AuraTechNotes/09.Python/11.python%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/01.python%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" title="无题">无题</a><time datetime="2023-07-27T02:02:00.000Z" title="发表于 2023-07-27 10:02:00">2023-07-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/20/01.AuraTechNotes/16.Linux/01.Linux%E4%B9%8B%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/01.%E5%9F%BA%E4%BA%8EWindows11%E5%AE%89%E8%A3%85Ubuntu%E5%8F%8C%E7%B3%BB%E7%BB%9F/" title="基于Windows11安装Ubuntu双系统">基于Windows11安装Ubuntu双系统</a><time datetime="2023-07-19T16:00:00.000Z" title="发表于 2023-07-20 00:00:00">2023-07-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/17/01.AuraTechNotes/09.Python/01.python%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0/12.%E6%90%AD%E5%BB%BAbaidu%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" title="无题">无题</a><time datetime="2023-07-17T12:35:38.000Z" title="发表于 2023-07-17 20:35:38">2023-07-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/13/01.AuraTechNotes/20.AILearning/06.%E6%B7%B1%E5%BA%A6%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E9%87%8F%E5%8C%96%E5%8A%A0%E9%80%9F/08.QNN%E6%8E%A8%E7%90%86%E9%87%8F%E5%8C%96%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/" title="无题">无题</a><time datetime="2023-06-13T14:28:06.000Z" title="发表于 2023-06-13 22:28:06">2023-06-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Frewen.Wang</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><script>(() => {
  const disqus_config = function () {
    this.page.url = 'http://www.frewen.wang/2021/12/20/01.AuraTechNotes/20.AILearning/19.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%AD%A6%E4%B9%A0/01.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E6%8C%87%E4%BB%A4%E7%AE%80%E4%BB%8B/'
    this.page.identifier = '/2021/12/20/01.AuraTechNotes/20.AILearning/19.ARM%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84NEON%E5%8A%A0%E9%80%9F%E5%AD%A6%E4%B9%A0/01.ARM%E5%B9%B3%E5%8F%B0NEON%E5%8A%A0%E9%80%9F%E6%8C%87%E4%BB%A4%E7%AE%80%E4%BB%8B/'
    this.page.title = 'ARM平台上的NEON加速基础'
  }

  const disqusReset = () => {
    window.DISQUS && window.DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  btf.addGlobalFn('themeChange', disqusReset, 'disqus')

  const loadDisqus = () =>{
    if (window.DISQUS) disqusReset()
    else {
      const script = document.createElement('script')
      script.src = 'https://.disqus.com/embed.js'
      script.setAttribute('data-timestamp', +new Date())
      document.head.appendChild(script)
    }
  }

  const getCount = async() => {
    try {
      const eleGroup = document.querySelector('#post-meta .disqus-comment-count')
      if (!eleGroup) return
      const cleanedLinks = eleGroup.href.replace(/#post-comment$/, '')

      const res = await fetch(`https://disqus.com/api/3.0/threads/set.json?forum=&api_key=&thread:link=${cleanedLinks}`,{
        method: 'GET'
      })
      const result = await res.json()

      const count = result.response.length ? result.response[0].posts : 0
      eleGroup.textContent = count
    } catch (err) {
      console.error(err)
    }
  }

  if ('Valine' === 'Disqus' || !false) {
    if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
    else {
      loadDisqus()
      GLOBAL_CONFIG_SITE.isPost && getCount()
    }
  } else {
    window.loadOtherComment = loadDisqus
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>